<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FastAPI CORS Test with AJAX</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .container {
            background-color: #f5f5f5;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }

        button:hover {
            background-color: #45a049;
        }

        input,
        textarea {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            box-sizing: border-box;
        }

        #result {
            background-color: #e7f3ff;
            border-left: 6px solid #2196F3;
            padding: 10px;
            margin-top: 10px;
            min-height: 50px;
        }

        .test-section {
            margin-bottom: 30px;
        }

        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }

        .success {
            background-color: #dff0d8;
            color: #3c763d;
        }

        .error {
            background-color: #f2dede;
            color: #a94442;
        }
    </style>
</head>

<body>
    <h1>FastAPI CORS Testing with AJAX</h1>

    <div class="test-section">
        <h2>AJAX GET Requests</h2>
        <div class="container">
            <button id="ajaxGetRoot">AJAX GET Root (/)</button>
            <button id="ajaxGetItems">AJAX GET Items (/items/)</button>
        </div>
    </div>

    <div class="test-section">
        <h2>AJAX POST Request</h2>
        <div class="container">
            <input type="text" id="itemName" placeholder="Item Name">
            <textarea id="itemDescription" placeholder="Item Description"></textarea>
            <button id="ajaxCreateItem">AJAX POST Create Item (/items/)</button>
        </div>
    </div>

    <div class="test-section">
        <h2>AJAX Error Handling</h2>
        <div class="container">
            <button id="ajaxNonExistent">AJAX GET Non-existent Endpoint</button>
            <button id="ajaxWrongMethod">AJAX PUT to GET-only Endpoint</button>
        </div>
    </div>

    <div class="test-section">
        <h2>Results</h2>
        <div class="container">
            <div id="result">Results will appear here...</div>
        </div>
    </div>

    <script>
        // API base URL - adjust according to your FastAPI server
        const API_BASE_URL = 'http://127.0.0.1:8000';

        function displayResult(data, message = '') {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = message ? `<p><strong>${message}</strong></p>` : '';
            resultDiv.innerHTML += '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
            resultDiv.className = 'status success';
        }

        function displayError(error, message = '') {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = message ? `<p><strong>${message}</strong></p>` : '';
            resultDiv.innerHTML += '<pre style="color: red;">Error: ' + error + '</pre>';
            resultDiv.className = 'status error';
        }

        // Traditional XMLHttpRequest (Vanilla AJAX)
        function makeAjaxRequest(method, url, data = null, successCallback, errorCallback) {
            const xhr = new XMLHttpRequest();

            xhr.open(method, url, true);
            xhr.setRequestHeader('Content-Type', 'application/json');

            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4) {
                    if (xhr.status >= 200 && xhr.status < 300) {
                        try {
                            const responseData = JSON.parse(xhr.responseText);
                            successCallback(responseData);
                        } catch (e) {
                            successCallback(xhr.responseText);
                        }
                    } else {
                        errorCallback(`HTTP ${xhr.status}: ${xhr.statusText}`);
                    }
                }
            };

            xhr.onerror = function () {
                errorCallback('Network error occurred');
            };

            if (data) {
                xhr.send(JSON.stringify(data));
            } else {
                xhr.send();
            }
        }

        // AJAX GET Requests
        document.getElementById('ajaxGetRoot').addEventListener('click', function () {
            makeAjaxRequest(
                'GET',
                `${API_BASE_URL}/`,
                null,
                function (data) {
                    displayResult(data, 'AJAX GET Root Success:');
                },
                function (error) {
                    displayError(error, 'AJAX GET Root Failed:');
                }
            );
        });

        document.getElementById('ajaxGetItems').addEventListener('click', function () {
            makeAjaxRequest(
                'GET',
                `${API_BASE_URL}/items/`,
                null,
                function (data) {
                    displayResult(data, 'AJAX GET Items Success:');
                },
                function (error) {
                    displayError(error, 'AJAX GET Items Failed:');
                }
            );
        });

        // AJAX POST Request
        document.getElementById('ajaxCreateItem').addEventListener('click', function () {
            const itemName = document.getElementById('itemName').value;
            const itemDescription = document.getElementById('itemDescription').value;

            if (!itemName) {
                displayError('Please enter an item name', 'Validation Error:');
                return;
            }

            const itemData = {
                name: itemName,
                description: itemDescription || null
            };

            makeAjaxRequest(
                'POST',
                `${API_BASE_URL}/items/`,
                itemData,
                function (data) {
                    displayResult(data, 'AJAX POST Item Success:');
                    // Clear input fields
                    document.getElementById('itemName').value = '';
                    document.getElementById('itemDescription').value = '';
                },
                function (error) {
                    displayError(error, 'AJAX POST Item Failed:');
                }
            );
        });

        // AJAX Error Cases
        document.getElementById('ajaxNonExistent').addEventListener('click', function () {
            makeAjaxRequest(
                'GET',
                `${API_BASE_URL}/non-existent-endpoint/`,
                null,
                function (data) {
                    displayResult(data, 'Unexpected Success:');
                },
                function (error) {
                    displayError(error, 'Expected 404 Error:');
                }
            );
        });

        document.getElementById('ajaxWrongMethod').addEventListener('click', function () {
            makeAjaxRequest(
                'PUT',
                `${API_BASE_URL}/`,
                { test: 'data' },
                function (data) {
                    displayResult(data, 'Unexpected Success:');
                },
                function (error) {
                    displayError(error, 'Expected Method Not Allowed Error:');
                }
            );
        });
    </script>
</body>

</html>